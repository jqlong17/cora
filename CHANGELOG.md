# 更新日志

## \[0.2.1] - 2026-03-02

### 优化

* **CoraWiki 报告质量**：大幅提升 AI 架构分析报告的深度与准确性：
  * 预分析阶段自动扫描热点模块（按文件数排序），并对 Top 5 模块入口文件执行 `read_skeleton` 预读，确保大模块不被遗漏
  * 强制并行工具调用（每轮 3-5 个），10 轮内可深入读取 15+ 代码文件，代码覆盖率显著提升
  * 移除泛化 fallback 架构图，Mermaid 图完全基于 LLM 实际阅读代码生成，反映真实模块依赖
  * 拦截重复文件读取，防止浪费工具调用轮次
  * 拦截非 JSON 提前收敛，避免模型输出 Markdown 文本浪费轮次
  * 强化 system prompt 要求 high-level 架构洞察（架构判断 ≥5 条、关键流程 ≥2 条、每条 ≥5 步），报告面向 Tech Lead / Architect 读者

## \[0.2.0] - 2026-03-01

### 新增（实验功能）

* **CoraWiki**：利用 AI 对工作区目录进行图谱化理解，生成结构化架构分析报告；支持一键「开始分析当前工作区架构」，报告中的文件引用可点击跳转；支持 OpenAI、Minimax、Kimi、OpenRouter 等模型，可在设置中配置 Provider、Model 及 API Key 环境变量；视图提供使用说明入口与空态介绍。

* **CoraPlan**：提供有约束的 Plan 书写方法论（DDD/TDD、完成标准与验收前置），减少 AI 写 Plan 时的幻觉并借测试降低人工验收频次；支持「在此工作区注入 CoraPlan」将约束与模板写入 `.cursor/plans`，推荐在 Agent 模式下由 AI 按约束生成 plan 并执行；视图提供打开约束说明、README 登记表及使用说明入口，空态文案从约束文档动态读取。

## \[0.1.11] - 2026-02-26

### 文档

* **产品定位更新**：明确 Cora 为 Cursor / AI 编程的「读、找、懂、规划」扩展；README 与扩展描述已更新，增加 Cora 与 AI 编程、CoraWiki、Plan 书写约束等说明；结尾 Slogan 与 Roadmap 已同步调整。

### 新增

* **Markdown 默认用 Cora 预览打开**：当开启「点击文件时默认打开预览」时，从 Cursor 对话中的文件链接、资源管理器点击等方式打开 `.md` / `.markdown` / `.mdx` 时，将直接使用 Cora 预览打开，而非系统自带编辑器。通过 Custom Editor 注册并同步 `workbench.editorAssociations` 实现；关闭该选项后恢复默认编辑器。

### 优化

* **页面树与平铺性能**：树展开时对同一目录内多个 entry 使用 `Promise.all` 并行 stat，减少顺序等待；平铺视图对「当前工作区 + 排序 + 筛选」结果做短期缓存（TTL 30 秒），刷新、配置变更或文件增删改时自动清空缓存；递归收集时跳过 `.git` 目录。平铺/树形切换与刷新时列表响应更快，大仓库体感更明显。

## \[0.1.10] - 2026-02-25

### 修复

* **Mermaid 预览**：预览模式下部分 Mermaid 代码块（如 `sequenceDiagram`）未渲染为图的问题；Marked 只读预览中会正确加载并渲染 Mermaid，与 Milkdown 编辑模式行为一致；语言标识不区分大小写（`mermaid` / `Mermaid` 等均识别）。

### 优化

* **语言与 Cursor**：界面语言与 VS Code / Cursor 一致，在 i18n 中补充说明 Cursor 使用同一 `vscode.env.language` API，便于后续维护。

## \[0.1.9] - 2026-02-25

### 新增

* **收藏功能**：页面树支持将 Markdown 文件加入收藏；树状/平铺下悬停或右键可「收藏/取消收藏」，已收藏项显示空心星标；新增**收藏**视图模式，仅展示已收藏文件列表，收藏数据按工作区持久化。

### 优化

* **页面树工具栏**：由单一「切换平铺/树形」改为独立按钮，顺序为：树状（默认）、平铺、收藏、排序、筛选、刷新、新建文件、新建文件夹；平铺使用网格图标、收藏使用星标图标。

* **预览/Markdown 激活态**：编辑器右上角「预览」「Markdown」按钮的激活背景色由紫色改为蓝色（#1a00ff），与品牌色一致。

## \[0.1.5] - 2026-02-25

### 新增

* **多字体系统**：集成四种专业字体，通过右上角 `Aa` 图标或设置即可实时切换：

  * **Cascadia Mono** (默认): 极快编写体验的等宽字体

  * **Google Sans**: 极具现代感的圆润无衬线字体

  * **IBM Plex Mono**: 硬朗、清晰的工业风等宽字体

  * **Noto Sans SC**: 优雅的中文正文排版支持

* **编辑器字号调节**：支持在 `12px` - `30px` 之间动态微调编辑器大小。

* **导航体验统一**：大纲 (Outline) 与搜索 (Search) 结果点击后，将直接在 Cora 高级双模编辑器中打开，并支持**精准行号定位**与平滑滚动。

* **Markdown 模式 · 划词 Add to Chat**：在源码（Markdown）模式下选中文字后，会显示「Add to Chat ⌘L」浮层；点击后将**文件 + 行范围**以定位引用形式送入 Cursor/VS Code 聊天（如 `项目计划.md (第5行)`、`项目计划.md (第3-5行)`），与 Cursor 原生「定位引用」语义一致，便于 AI 按行定位上下文。

* **显示设置**：右上角入口由「字体设置」更名为「显示设置」，支持在一层列表中平铺选择并立即生效：字体系列、字号（12–30px 预设）、行间距（预览）/ 行间距（Markdown）（1.2 紧凑～2.0 宽松）。配置项：`knowledgeBase.lineHeightPreview`、`knowledgeBase.lineHeightSource`（默认 1.5 / 1.6）。

### 优化

* **UI 纯净化**：

  * 优化编辑器标题栏，将原「打开编辑」图标重构为「显示设置」入口，字体系列、字号与行间距统一在此设置。

* **编辑器性能**：

  * 采用 Milkdown 引擎实现的 Typora 级实时编辑/预览混合体验。

  * 优化了 Webview 内部的模式切换平滑度及两端内容同步效率。

## \[0.1.4] - 2026-02-24

### 优化

* **大纲**

  * 图标简化：仅用 H1、H2、H3 文字标识层级，移除复杂图标

  * 实时更新：编辑时大纲随内容更新（含 Cora 编辑模式）；保存后自动刷新

  * 点击跳转：修复预览/编辑模式下「没有活动的编辑器」问题，多层 fallback 保证可跳转

* **预览/编辑**

  * 工具栏固定到右上角（`position: fixed`），切换模式时按钮位置不再偏移

  * 左侧面板默认比例：页面 50%、大纲 25%、搜索 25%

* **页面树**

  * 默认改为树形展示（`pageViewMode` 默认 `tree`）

  * 新建笔记/文件夹：输入框提示「将创建于: 路径」；无选中时先定位到根节点；标题栏增加「新建文件夹」按钮

### 修复

* 大纲在编辑后不更新的问题（弃用缓存、防抖、Webview 切回时不覆盖）

* 编辑模式保存后大纲不刷新的问题（`onDocumentSaved` 回调）

### 测试

* E2E：新增「保存后大纲刷新」「编辑后大纲实时更新」用例

## \[0.1.3] - 2024-02-24

### 优化

* **交互体验**：

  * 搜索区域：弱化「开始搜索」按钮视觉权重，改为更自然的内联链接。

  * 过滤按钮：文案修改为「显示全部文件 / 仅显示 MD 文件」，语义更直观。

  * 移除页面树中冗余的「全部展开/折叠」按钮，保持界面简洁。

* **图标**：更新扩展图标为现代白底风格，提升视觉识别度。

### 修复

* **大纲视图**：

  * 修复「全部展开」功能在某些情况下不生效的问题。

  * 解决「全部折叠」按钮重复显示的问题。

* **测试**：修复 E2E 测试中的命令注册检查和大纲层级断言问题。

## \[0.1.2] - 2024-02-24

### 新增

* 自动化发布流程：支持一键发布到 VS Code Marketplace 和 Open VSX Registry。

## \[0.1.1] - 2024-02-23

### 修复

* 修复已知的小问题和性能优化。

## \[0.1.0] - 2024-02-23

### 新增

* Cora 面板（ActivityBar 入口）

* 页面树视图

  * 工作区文件树展示

  * Markdown/全部文件过滤切换

  * 新建笔记、新建文件夹

  * 重命名、删除文件

  * 全部展开、全部折叠

* 大纲视图

  * 实时跟随激活编辑器

  * 自动提取 H1-H6 标题

  * 点击跳转功能

* 数据库视图（MVP 预留占位）

* 预览优先编辑模式

  * 点击 Markdown 文件默认打开预览

  * Cmd+E 切换到编辑模式

  * Cmd+Shift+V 打开预览
